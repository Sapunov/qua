## Микросервисы поиска


QUA позволяет подключать собственные микросервисы для поиска по каким-либо
базам данных, тем самым достигается неограниченная расширяемость поисковых
возможностей сервиса.


## Требования для пользовательских микросервисов

Пользовательский микросервис может быть написан на любом доступном языке
программирования. Единственный способ взаимодействия с основным сервисом, в
котором происходит смешивание результатов от разных сервисов - http rest api.


### Точка входа приложения

Сервис должен иметь обслуживаемый адрес `/search`, по которому и должен
возвразаться ответ. Другими словами, когда основной сервис QUA захочет
обратиться к пользовательскому микросервисы, он запросит методом GET адрес
`http://hostname:port/search`


### Параметры запроса

Сервис должен поддерживать 3 параметра запроса:

- `query` - сам поисковый запрос
- `limit` - количество возвращаемых результатов
- `offset` - смещение (постраничный вывод информации)


### Формат возвращаемого значения

Сервис должен возвращать json с правильными заголовками и кодом
ответа сервера 200 в следующем формате(указаны обязательные поля):

```json
{
    "hits": [],
    "query": "<string>",
    "total": <int>,
    "max_score": <float>,
    "min_score": <float>
}
```

Здесь:

- `hits` - список результатов. Формат результатов ниже
- `query` - введенный запрос
- `total` - общее количество найденных элементов
    (может не совпадать с возвращаемым размером hits)
- `max_score` - максимальный рейтинг, который встречается в hits. Данное поле
    нужно для нормализации значений при смешивании результатов
- `min_score` - минимальный рейтинг, который встречается в hits.


Каждый hit должен иметь следующие обязательные поля:

```json
{
    "_type": "<string>",
    "_item_id": "<string>",
    "_score": <float>,
    "_loc": <string>
}
```

Здесь:

- `_type` - тип результата(main, widget[, custom_name])
- `_item_id` - идентификатор в соответствующем сервисе
- `_score` - показатель релевантности
- `_loc` - 'позиция поискового результата на странице выдачи(top|middle|right)'

Нижнее подчеркивание перед названием параметра говорит о том, что это поле
в результате является обязательным(системным). Это позволяет создавать свои
поля с произвольными названиями(без нижнего подчеркивания).
